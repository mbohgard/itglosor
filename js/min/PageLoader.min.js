define(["Helpers","lib/jquery"],function(e){var t,n=$([]),r,i,s,o="webkitTransitionEnd transitionend",u=0,a=function(e,t,n,r){var i,s,o,u;if(r){u='Se <a href="#search/'+r+'">'+r+"</a>.";return u}r="";$.each(e,function(e,o){s=o.word;if(s!==t&&o.pointer!==t){i=new RegExp(s,"gi");n=n.replace(i,' <a href="#search/'+s+'">'+s+"</a> ")}r+=o.pointer===t?", "+s:"";u={desc:n,pointer:r}});return u},f=function(){var t=$(".word-list ul"),n=t.find(".template"),r,i,s,o,u,f,l;o=e.getData().words.sort(e.sortBy("word",!0));$.each(o,function(e,c){r=n.clone();i=r.find(".word");s=r.find(".word-desc p");f=c.desc;l=c.pointer;u=c.word;f=a(o,u,f,l);if(typeof f=="object"){l=f.pointer.substring(2);f=f.desc;l&&s.find(".pointer").text(l).addClass("is-visible")}i.text(u);s.prepend(f);c.pointer&&r.addClass("pointer");r.removeClass("template").appendTo(t)});h()},l=function(){var t=e.getData().requested,n=$(".request-info ul"),r=n.find(".template"),i;n.find("li:not(.template)").remove();$.each(t,function(e,t){i=r.clone();i.removeClass("template").text(t).appendTo(n)})},c=function(){var t=e.getData().requested,n=$(".contribute ul"),r=n.find(".template"),i=0;n.find("li:not(.template)").remove();$.each(t,function(e,t){var s=r.clone();s.removeClass("template").find("a").text(t);s.appendTo(n);setTimeout(function(){s.find("a").removeClass("is-hidden")},i);i+=150})},h=function(){clearInterval(s);i.css({width:"100%"});setTimeout(function(){i.css({opacity:0})},500);setTimeout(function(){r.addClass("remove");e.url()?e.url(e.url()):e.url("#search")},750);setTimeout(function(){$(document).trigger("reloadbrick");r.remove()},1100)},p=function(){var t="data.json",n=1,r;$.getJSON(t).done(function(t){e.setData(t);f()});s=setInterval(function(){i.css({width:n+"%"});r=Math.floor(Math.random()*15+1);n>90?n+=.1:n+=r},100)},d=function(){var r=e.url().substring(1),i,s=0;for(var u in t){i=t[u];if(u===r){i.show();e.setClass(i,"is-active")}else i.removeClass("is-active").on(o,function(){n.not(".is-active").hide().off(o)})}e.url()==="#request"?l():e.url()==="#contribute"&&c()},v=function(){e.onUrlChange(function(){e.urlContains("/")||e.url(e.url()+"/");e.url().indexOf("/")===-1&&d();console.log("Change event run "+ ++u+" times.")})};return{init:function(e){console.log("PageLoader initialized");t=e.pages;n=$(".page");r=$(".blinds");i=r.find(".blinds-progress");v();p()}}});